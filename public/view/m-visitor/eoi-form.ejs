<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expression of Interest Form</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #f3f4f6;
            font-family: 'Arial', sans-serif;
        }

        main {
            max-width: 1200px;
            margin: 2rem auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .header h1 {
            color: #dc2626;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header h3 {
            color: #6b7280;
            font-size: 1.1rem;
        }

        .form-section {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .flex-col {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        input, select, textarea {
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 0.625rem;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            width: 100%;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .radio-group {
            display: flex;
            gap: 2rem;
            margin-top: 0.5rem;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .radio-option input[type="radio"] {
            width: auto;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid #e5e7eb;
        }

        .btn {
            background: #dc2626;
            color: white;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            background: #b91c1c;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        @media print {
            body {
                background: white;
            }

            main {
                box-shadow: none;
                margin: 0;
                padding: 1rem;
            }

            .btn {
                display: none;
            }

            input, select, textarea {
                border: none;
            }
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }

            .radio-group {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <main>
        <div class="header">
            <h1>Expression of Interest Form</h1>
            <h3>BNI Membership Application</h3>
        </div>

        <form id="eoiForm">
            <!-- Membership Interest Section -->
            <section class="form-section">
                <div class="flex-col">
                    <label>Are you interested in becoming a member of BNI?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" name="membershipInterest" id="yes" value="Yes">
                            <label for="yes">Yes, I'm ready to get started</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" name="membershipInterest" id="maybe" value="Maybe">
                            <label for="maybe">Maybe, I would like more information</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" name="membershipInterest" id="no" value="No">
                            <label for="no">No, not as of now</label>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Chapter Information -->
            <section class="form-section">
                <div class="grid-2">
                    <div class="flex-col">
                        <label for="region">BNI Region</label>
                        <select id="region" name="region">
                            <option value="">Select Region</option>
                        </select>
                    </div>
                    <div class="flex-col">
                        <label for="chapter">BNI Chapter</label>
                        <select id="chapter" name="chapter">
                            <option value="">Select Chapter</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- Personal Information -->
            <section class="form-section">
                <h3 style="margin-bottom: 1rem; color: #374151;">Personal Information</h3>
                <div class="grid-2">
                    <div class="flex-col">
                        <label for="firstName">First Name</label>
                        <input type="text" id="firstName" name="firstName">
                    </div>
                    <div class="flex-col">
                        <label for="lastName">Last Name</label>
                        <input type="text" id="lastName" name="lastName">
                    </div>
                </div>
                <div class="flex-col">
                    <label for="memberName">Invited By Name</label>
                    <input type="text" id="memberName" name="memberName">
                </div>
                <div class="flex-col">
                    <label for="visitDate">Chapter Visit Date</label>
                    <input type="date" id="visitDate" name="visitDate">
                </div>
            </section>

            <!-- Business Information -->
            <section class="form-section">
                <h3 style="margin-bottom: 1rem; color: #374151;">Business Information</h3>
                <div class="grid-2">
                    <div class="flex-col">
                        <label for="companyName">Company Name</label>
                        <input type="text" id="companyName" name="companyName">
                    </div>
                    <div class="flex-col">
                        <label for="professionalClassification">Professional Classification</label>
                        <input type="text" id="professionalClassification" name="professionalClassification">
                    </div>
                </div>
                <div class="flex-col">
                    <label for="industry">Industry</label>
                    <input type="text" id="industry" name="industry">
                </div>
            </section>

            <!-- Contact Information -->
            <section class="form-section">
                <h3 style="margin-bottom: 1rem; color: #374151;">Contact Information</h3>
                <div class="grid-2">
                    <div class="flex-col">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email">
                    </div>
                    <div class="flex-col">
                        <label for="mobile">Mobile</label>
                        <input type="text" id="mobile" name="mobile" maxlength="10" pattern="\d{10}">
                    </div>
                </div>
                <div class="flex-col">
                    <label for="bestTimeToReach">Best time to reach you?</label>
                    <input type="text" id="bestTimeToReach" name="bestTimeToReach">
                </div>
            </section>

            <!-- Additional Information -->
            <section class="form-section">
                <h3 style="margin-bottom: 1rem; color: #374151;">Additional Information</h3>
                <div class="grid-2">
                    <div class="flex-col">
                        <label for="gstin">GSTIN</label>
                        <input type="text" id="gstin" name="gstin" maxlength="15">
                    </div>
                    <div class="flex-col">
                        <label for="companyAddress">Company Address</label>
                        <input type="text" id="companyAddress" name="companyAddress">
                    </div>
                </div>
                <div class="flex-col">
                    <label for="descriptionBox">Description Box</label>
                    <input type="text" id="descriptionBox" name="descriptionBox" maxlength="250">
                </div>
            </section>

            <!-- How did you hear about us? -->
            <section class="form-section">
                <h3 style="margin-bottom: 1rem; color: #374151;">How did you hear about us?</h3>
                <div class="grid-2">
                    <div class="flex-col">
                        <label for="howHeard">Select an option</label>
                        <select id="howHeard" name="howHeard">
                            <option value="">Select an option</option>
                            <option value="Social Media">Social Media</option>
                            <option value="Friend or Colleague">Friend or Colleague</option>
                            <option value="BNI Website">BNI Website</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="flex-col">
                        <label for="previousMember">Have you been a BNI member previously?</label>
                        <select id="previousMember" name="previousMember">
                            <option value="">Select</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- Meeting Experience -->
            <section class="form-section">
                <h3 style="margin-bottom: 1rem; color: #374151;">Meeting Experience</h3>
                <div class="flex-col">
                    <label for="experienceRating">On a scale of 1-10, How was your experience in this meeting?</label>
                    <input 
                        type="number" 
                        id="experienceRating" 
                        name="experienceRating" 
                        min="1" 
                        max="10" 
                        style="max-width: 100px;"
                        placeholder="1-10"
                    >
                    <small style="color: #6b7280; margin-top: 0.25rem;">1 = Poor, 10 = Excellent</small>
                </div>
            </section>

            <!-- Button Group -->
            <div class="button-group">
                <button type="button" class="btn" onclick="window.location.href='/t/manage-visitors'">
                    Back
                </button>
                <button type="button" class="btn" onclick="handlePrint()">
                    Print / Download
                </button>
            </div>
        </form>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Get visitor_id from URL
                const urlParams = new URLSearchParams(window.location.search);
                const visitorId = urlParams.get('visitor_id');
                
                console.log('Fetching data for visitor_id:', visitorId);

                // Fetch EOI Form data
                const eoiResponse = await fetch(`https://backend.bninewdelhi.com/api/getEoiForms`);
                const eoiForms = await eoiResponse.json();
                console.log('All EOI Forms:', eoiForms);

                // Find matching EOI form
                const eoiData = eoiForms.find(form => form.visitor_id === parseInt(visitorId));
                console.log('Matching EOI Form:', eoiData);

                if (!eoiData) {
                    console.error('No EOI form found for visitor_id:', visitorId);
                    return;
                }

                // Fetch Regions
                const regionsResponse = await fetch('https://backend.bninewdelhi.com/api/regions');
                const regions = await regionsResponse.json();
                console.log('Regions data:', regions);

                // Fetch Chapters
                const chaptersResponse = await fetch('https://backend.bninewdelhi.com/api/chapters');
                const chapters = await chaptersResponse.json();
                console.log('Chapters data:', chapters);

                // Fetch Members
                const membersResponse = await fetch('https://backend.bninewdelhi.com/api/members');
                const members = await membersResponse.json();
                console.log('Members data:', members);

                // Find matching region, chapter and member
                const matchingRegion = regions.find(region => region.region_id === eoiData.region_id);
                const matchingChapter = chapters.find(chapter => chapter.chapter_id === eoiData.chapter_id);
                const matchingMember = members.find(member => member.member_id === eoiData.invited_by_member_id);

                console.log('Matching Region:', matchingRegion);
                console.log('Matching Chapter:', matchingChapter);
                console.log('Matching Member:', matchingMember);

                // Set radio button based on is_interested
                const radioButton = document.querySelector(`input[value="${eoiData.is_interested}"]`);
                if (radioButton) {
                    radioButton.checked = true;
                }

                // Populate form fields
                document.getElementById('region').innerHTML = `<option selected>${matchingRegion?.region_name || ''}</option>`;
                document.getElementById('chapter').innerHTML = `<option selected>${matchingChapter?.chapter_name || ''}</option>`;
                document.getElementById('firstName').value = eoiData.first_name;
                document.getElementById('lastName').value = eoiData.last_name;
                document.getElementById('memberName').value = `${matchingMember?.member_first_name || ''} ${matchingMember?.member_last_name || ''}`;
                document.getElementById('visitDate').value = eoiData.chapter_visit_date.split('T')[0];
                document.getElementById('companyName').value = eoiData.company_name;
                document.getElementById('professionalClassification').value = eoiData.category;
                document.getElementById('industry').value = eoiData.business;
                document.getElementById('email').value = eoiData.email;
                document.getElementById('mobile').value = eoiData.phone_no;
                document.getElementById('bestTimeToReach').value = eoiData.best_time_to_reach;
                document.getElementById('gstin').value = eoiData.company_gstin;
                document.getElementById('companyAddress').value = eoiData.company_address;
                document.getElementById('howHeard').value = eoiData.hear_about_us;
                document.getElementById('previousMember').value = eoiData.previous_member ? 'Yes' : 'No';
                document.getElementById('experienceRating').value = eoiData.exp_rating;

                // Make all form elements readonly
                document.querySelectorAll('input, select, textarea').forEach(element => {
                    element.setAttribute('readonly', true);
                    if (element.tagName === 'SELECT') {
                        element.style.pointerEvents = 'none';
                    }
                    element.style.backgroundColor = '#f3f4f6';
                });

                // Disable radio buttons
                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.disabled = true;
                });

            } catch (error) {
                console.error('Error fetching data:', error);
            }
        });

        // Add this function for print handling
        function handlePrint() {
            // Create print preview and download options
            const opt = {
                margin: 1,
                filename: 'EOI_Form.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            // Hide buttons before printing
            const buttons = document.querySelector('.button-group');
            buttons.style.display = 'none';

            // Print the document
            window.print();

            // Show buttons after printing dialog closes
            setTimeout(() => {
                buttons.style.display = 'flex';
            }, 1000);
        }
    </script>

    <!-- Add print-specific styles -->
    <style>
        @media print {
            .button-group {
                display: none !important;
            }
            
            @page {
                size: A4;
                margin: 2cm;
            }

            body {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }

            main {
                box-shadow: none;
                margin: 0;
                padding: 0;
            }
        }
    </style>
</body>
</html>
