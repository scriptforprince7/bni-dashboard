
      <!-- Add this right after <body> tag -->
        <script src="/assets/js/tokenUtils.js"></script>
        <script>
            (function checkAccess() {
                try {
                    const loginType = getUserLoginType();
                    if (loginType !== 'ro_admin') {
                        document.body.innerHTML = `
                            <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f8f9fa;">
                                <div style="text-align: center; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    <h2 style="color: #dc3545; margin-bottom: 10px;">Unauthorized Access</h2>
                                    <p style="color: #6c757d;">Only RO Admin can access this page.</p>
                                    <a href="/" style="display: inline-block; margin-top: 15px; padding: 8px 16px; background-color: #0d6efd; color: white; text-decoration: none; border-radius: 4px;">Go to Home</a>
                                </div>
                            </div>
                        `;
                    }
                } catch (error) {
                    console.error('Access check failed:', error);
                    window.location.href = '/';
                }
            })();
        </script>
        <!-- header -->
<%- include('../partials/header') %>
<!-- end header -->

<!-- sidebar -->

<%- include('../partials/sidebar') %>

<!-- end sidebar -->
<style>
  
  /* Ensuring that the modal body has padding */
  .modal-body {
    padding: 20px;
  }
  /* Preventing the add button container from affecting layout */
  .add-button-container {
    margin-top: 10px; /* Space above the button */
    display: none; /* Initially hidden */
  }
</style>
<style>
  .custom-dropdown {
    position: relative;
    cursor: pointer;
    border: 1px solid #ccc;
    padding: 10px;
    border-radius: 5px;
  }

  .options {
    display: none;
    position: absolute;
    border: 1px solid #ccc;
    background: white;
    width: 100%;
    max-height: 200px;
    overflow-y: auto;
    z-index: 1;
  }

  .options div {
    padding: 10px;
    display: flex;
    align-items: center;
  }

  .options div:hover {
    background-color: #f0f0f0;
  }

  .selected {
    display: flex;
    align-items: center;
  }
</style>

<!-- Start::app-content -->
<div class="main-content app-content" style="background-color: #f4f4f4">
  <div class="container-fluid">
    <!-- Start::page-header -->
    <div
      class="d-flex align-items-center justify-content-between page-header-breadcrumb flex-wrap gap-2"
    >
      <!-- <div>
        <h1 class="page-title fw-medium fs-18 mb-0">
          <span style="font-weight: 700; font-family: Poppins"
            >Edit Universal Link</span
          >
        </h1>
        <p>Manage kitty payments with just one click</p>
      </div> -->
      <!-- <div class="d-flex align-items-center gap-2 flex-wrap">
              <div class="form-group">
                <div class="input-group">
                  <div class="input-group-text bg-white border">
                    <i class="ri-calendar-line"></i>
                  </div>
                  <input
                    type="text"
                    class="form-control breadcrumb-input"
                    id="daterange"
                    placeholder="Search By Date Range"
                  />
                </div>
              </div>
              <div class="btn-list">
                <button class="btn btn-white btn-wave">
                  <i class="ri-filter-3-line align-middle me-1 lh-1"></i> Filter
                </button>
                <button class="btn btn-primary btn-wave me-0">
                  <i class="ri-share-forward-line me-1"></i> Share
                </button>
              </div>
            </div> -->
    </div>
    <!-- End::page-header -->
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap");

      @import url("https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
    </style>

    <style>
      * {
        font-family: Montserrat !important;
        font-weight: 800px;
      }
      .text-muted {
        color: black !important;
        font-family: Montserrat Alternates;
      }
      .popins {
        font-family: Poppins;
      }
    </style>

    <form id="">
    <div class="row">
      <div class="col-xl-12">
        <div class="card custom-card">
          <div class="card-body add-products">
            <div class="row gx-4">
              <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-6">
                <div class="card custom-card shadow-none mb-0 border-0">
                  <div class="card-body p-0">
                    <div class="row gy-3">
                      <div class="col-xl-12">
                        <label for="product-cost-add" class="form-label"
                          ><span style="font-size: 15px"
                            ><b>Edit Vendor Details</b></span
                          ></label
                        >
                      </div>
                      <div class="col-xl-6">
                        <label for="vendor_name" class="form-label"
                          >Vendor Name</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="vendor_name"
                          name="vendor_name"
                          placeholder="Enter vendor name"
                        />
                      </div>    
                      <div class="col-xl-6">
                        <label for="vendor_company_name" class="form-label"
                          >Company Name</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="vendor_company_name"
                          name="vendor_company_name"
                          placeholder="Enter company name"
                        />
                      </div> 
                      <div class="col-xl-6">
                        <label for="vendor_company_address" class="form-label">Company Address</label>
                        <input
                            type="text"
                            class="form-control"
                            id="vendor_company_address"
                            name="vendor_company_address"
                            placeholder="Enter company address"
                        />
                      </div> 

                      <div class="col-xl-6">
                        <label for="vendor_company_gst" class="form-label"
                          >GST Number</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="vendor_company_gst"
                          name="vendor_company_gst"
                          placeholder="Enter GST number"
                        />
                      </div> 
                      <div class="col-xl-6">
                        <label for="vendor_account" class="form-label"
                          >Account Number</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="vendor_account"
                          name="vendor_account"
                          placeholder="Enter account number"
                        />
                      </div>
                      <div class="col-xl-6">
                        <label for="vendor_bank_name" class="form-label"
                          >Bank Name</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="vendor_bank_name"
                          name="vendor_bank_name"
                          placeholder="Enter bank name"
                        />
                      </div>
                      <div class="col-xl-6">
                        <label for="vendor_ifsc_code" class="form-label"
                          >IFSC Code</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="vendor_ifsc_code"
                          name="vendor_ifsc_code"
                          placeholder="Enter IFSC code"
                        />
                      </div>
                      <div class="col-xl-6">
                        <label for="vendor_account_type" class="form-label">Account Type</label>
                        <select class="form-control" name="vendor_account_type" id="vendor_account_type">
                          <option value="">Select Account Type</option>
                          <option value="Savings">Savings</option>
                          <option value="Current">Current</option>
                        </select>
                      </div>
                      <div class="col-xl-6">
                        <label for="phone_number" class="form-label">Phone Number</label>
                        <input
                          type="tel"
                          class="form-control"
                          id="phone_number"
                          name="phone_number"
                          placeholder="Enter phone number"
                        />
                      </div>
                      <div class="col-xl-6">
                        <label for="email_id" class="form-label">Email ID</label>
                        <input
                          type="email"
                          class="form-control"
                          id="email_id"
                          name="email_id"
                          placeholder="Enter email address"
                        />
                      </div>
                      <div class="col-xl-6">
                        <label for="vendor_status" class="form-label">Status</label>
                        <select class="form-control" name="vendor_status" id="vendor_status">
                          <option value="">Select Status</option>
                          <option value="active">Active</option>
                          <option value="inactive">Inactive</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-footer border-top border-block-start-dashed d-sm-flex justify-content-end align-items-center">
            <button type="button" id="updateVendorBtn" class="btn btn-success me-2 mb-2 mb-sm-0">
                Update Vendor
              </button>
          </div>
        </div>
      </div>
    </div>
  </form>
  </div>
</div>
<!-- End::content  -->



</script>
<!-- <script src="../../assets/js/country.js"></script> -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    // Function to get vendor ID from URL query parameters
    function getVendorIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('id');
    }

    // Function to fetch vendor details
    async function fetchVendorDetails(vendorId) {
        try {
            // First fetch vendor details
            const response = await fetch(`http://localhost:5000/api/getVendor/${vendorId}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error('Failed to fetch vendor details');
            }

            const data = await response.json();
            
            if (!data.success) {
                throw new Error(data.message || 'Failed to fetch vendor details');
            }

            // Populate form fields with vendor data
            document.getElementById('vendor_name').value = data.data.vendor_name || '';
            document.getElementById('vendor_company_name').value = data.data.vendor_company_name || '';
            document.getElementById('vendor_company_address').value = data.data.vendor_company_address || '';
            document.getElementById('vendor_company_gst').value = data.data.vendor_company_gst || '';
            document.getElementById('vendor_account').value = data.data.vendor_account || '';
            document.getElementById('vendor_bank_name').value = data.data.vendor_bank_name || '';
            document.getElementById('vendor_ifsc_code').value = data.data.vendor_ifsc_code || '';
            document.getElementById('vendor_account_type').value = data.data.vendor_account_type || '';
            document.getElementById('phone_number').value = data.data.phone_number || '';
            document.getElementById('email_id').value = data.data.email_id || '';
            document.getElementById('vendor_status').value = data.data.vendor_status || '';

        } catch (error) {
            console.error('Error fetching vendor details:', error);
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: error.message || 'Failed to fetch vendor details. Please try again.'
            });
        }
    }

    // Function to update vendor details
    async function updateVendorDetails(vendorId) {
        try {
            const vendorData = {
                vendor_name: document.getElementById('vendor_name').value,
                vendor_company_name: document.getElementById('vendor_company_name').value,
                vendor_company_address: document.getElementById('vendor_company_address').value,
                vendor_company_gst: document.getElementById('vendor_company_gst').value,
                vendor_account: document.getElementById('vendor_account').value,
                vendor_bank_name: document.getElementById('vendor_bank_name').value,
                vendor_ifsc_code: document.getElementById('vendor_ifsc_code').value,
                vendor_account_type: document.getElementById('vendor_account_type').value,
                vendor_status: document.getElementById('vendor_status').value,
                phone_number: document.getElementById('phone_number').value,
                email_id: document.getElementById('email_id').value
            };

            const response = await fetch(`http://localhost:5000/api/updateVendor/${vendorId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(vendorData)
            });

            const data = await response.json();

            if (!data.success) {
                throw new Error(data.message || 'Failed to update vendor');
            }

            Swal.fire({
                icon: 'success',
                title: 'Success',
                text: 'Vendor updated successfully'
            }).then(() => {
                // Optionally redirect to vendor list page
                // window.location.href = '/rexp/all-vendors';
            });

        } catch (error) {
            console.error('Error updating vendor:', error);
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: error.message || 'Failed to update vendor. Please try again.'
            });
        }
    }

    // Fetch vendor details when page loads
    document.addEventListener('DOMContentLoaded', () => {
        const vendorId = getVendorIdFromUrl();
        if (vendorId) {
            fetchVendorDetails(vendorId);
        } else {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'No vendor ID provided in URL. Please add ?id=1 to the URL'
            });
        }
    });

    // Add click event listener to update button
    document.getElementById('updateVendorBtn').addEventListener('click', () => {
        const vendorId = getVendorIdFromUrl();
        if (vendorId) {
            updateVendorDetails(vendorId);
        }
    });
</script>

<%- include('../partials/footer') %>

<style>
    .dropdown-menu {
        max-height: 300px;
        overflow-y: auto;
    }
    .dropdown-item {
        white-space: normal;
        padding: 8px 16px;
    }
</style>
