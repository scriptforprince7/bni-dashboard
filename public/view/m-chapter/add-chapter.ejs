<!-- header -->
<%- include('../partials/header') %> 
<!-- end header -->

<!-- sidebar -->

<%- include('../partials/sidebar') %>

<!-- end sidebar -->

<style>
  
  /* Ensuring that the modal body has padding */
  .modal-body {
    padding: 20px;
  }
  /* Preventing the add button container from affecting layout */
  .add-button-container {
    margin-top: 10px; /* Space above the button */
    display: none; /* Initially hidden */
  }
</style>
<meta content="keyword">
<style>
  /* Custom styling for checkboxes */
  input[type="checkbox"] {
    appearance: none;
    width: 17px;
    height: 18px;
    border: 2px solid #888;
    border-radius: 4px;
    outline: none;
    cursor: not-allowed; /* Cursor will indicate non-editable */
    display: inline-block;
    position: relative;
  }

  /* Styling for the checkbox when checked */
  input[type="checkbox"]:checked {
    background-color: green; /* Green background for checked state */
    border-color: green; /* Border will also be green */
  }

  /* Add a checkmark when the checkbox is checked */
  input[type="checkbox"]:checked::after {
    content: '✓';
    color: white;
    font-size: 16px;
    position: absolute;
    top: -2px;
    left: 2px;
  }
</style>

      <!-- Start::app-content -->
      <div class="main-content app-content" style="background-color: #f4f4f4">
        <div class="container-fluid">
          <!-- Start::page-header -->
          <div
            class="d-flex align-items-center justify-content-between page-header-breadcrumb flex-wrap gap-2"
          >
            <div>
              <h1 class="page-title fw-medium fs-18 mb-0">
                <span style="font-weight: 700; font-family: Poppins"
                  >Add New Chapter</span
                >
              </h1>
              <!-- <p>Manage kitty payments with just one click</p> -->
            </div>
            <!-- <div class="d-flex align-items-center gap-2 flex-wrap">
              <div class="form-group">
                <div class="input-group">
                  <div class="input-group-text bg-white border">
                    <i class="ri-calendar-line"></i>
                  </div>
                  <input
                    type="text"
                    class="form-control breadcrumb-input"
                    id="daterange"
                    placeholder="Search By Date Range"
                  />
                </div>
              </div>
              <div class="btn-list">
                <button class="btn btn-white btn-wave">
                  <i class="ri-filter-3-line align-middle me-1 lh-1"></i> Filter
                </button>
                <button class="btn btn-primary btn-wave me-0">
                  <i class="ri-share-forward-line me-1"></i> Share
                </button>
              </div>
            </div> -->
          </div>
          <!-- End::page-header -->
          <style>
            @import url("https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap");

            @import url("https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
          </style>

          <style>
            * {
              font-family: Montserrat !important;
              font-weight: 800px;
            }
            .text-muted {
              color: black !important;
              font-family: Montserrat Alternates;
            }
            .popins {
              font-family: Poppins;
            }
          </style>
          <form id="addChapterForm">
          <div class="row">
            <div class="col-xl-12">
              <div class="card custom-card">
                <div class="card-body add-products">
                  <div class="row gx-4">
                    <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-6">
                      <div class="card custom-card shadow-none mb-0 border-0">
                        <div class="card-body p-0">
                          <div class="row gy-3">
                            <div class="col-xl-12">
                              <label for="product-cost-add" class="form-label"
                                ><span style="font-size: 15px"
                                  ><b>It's time for a new chapter!</b></span
                                ></label
                              >
                            </div>
                            <div class="col-xl-6">
                              <label for="chapter_name" class="form-label">Enter Chapter Name</label>
                              <input
                                  type="text"
                                  class="form-control"
                                  id="chapter_name"
                                  name="chapter_name"
                                  
                                  placeholder="New chapter name.."
                              />
                              <label for="chapter_name" class="form-label mt-1 fs-12 fw-normal text-muted mb-0">
                                  <span style="color: red">*Mention the acknowledged name of the chapter</span>
                              </label>
                          </div>
                            <div class="col-xl-6">
                              <label for="region_id" class="form-label">Choose Region <a href="/r/add-region">
                                <button type="button" class="btn btn-outline-info btn-sm">Add Region +</button>
                              </a></label>
                              <select class="form-control" name="region_id" id="region_id">
                                <option value="">Select</option>
                              </select>
                            </div>
                            
                            <div class="col-xl-6" id="accolades-container" style="display: none; background-color: 		#F0F0F0; padding: 10px; border-radius: 8px;">
                              <label for="accolades-list" class="form-label">Accolades by Region</label>
                              <div id="accolades-list" style="display: flex; flex-direction: column;">
                                <!-- Accolades checkboxes will be dynamically populated here -->
                              </div>
                            </div>
                            <div class="col-xl-6">
                              <label for="chapter_meeting_day" class="form-label">Chapter Meeting Day</label>
                              <select class="form-control" id="chapter_meeting_day"
                              name="chapter_meeting_day"
                              >
                                <option value="">Select</option>
                              </select>
                            </div>
                            <div class="col-xl-6">
                              <label for="chapter_type" class="form-label"
                                >Chapter Type</label
                              >
                              <select
                                class="form-control"
                                data-trigger=""
                                id="chapter_type"
                                name="chapter_type"
                                
                              >
                                <option value="">Select</option>
                              </select>
                            </div>
                            <div class="col-xl-6">
                              <label for="contact_person" class="form-label"
                                >Contact Person
                                
                              </label>
                              <input
                                type="text"
                                class="form-control"
                                id="contact_person"
                          name="contact_person"
                          
                                placeholder="Name of the contact person..."
                              />
                            </div>

                            <div class="col-xl-6">
                              <label for="contact_number" class="form-label"
                                >Contact Number</label
                              >
                              <div class="input-group">
                                <span class="input-group-text">
                                  <img
                                    src="https://upload.wikimedia.org/wikipedia/en/4/41/Flag_of_India.svg"
                                    alt="India"
                                    width="20"
                                    style="margin-right: 5px"
                                  />
                                  91+
                                </span>
                                <input
                                  type="tel"
                                  class="form-control"
                                  id="contact_number"
                          name="contact_number"
                          
                                  placeholder="Enter phone number"
                                />
                              </div>
                            </div>

                            
                            
                            <div class="col-xl-6">
                              <label for="email_id" class="form-label"
                                >Email ID
                                <span style="color: red">(If registered)</span>
                              </label>
                              <input
                                type="text"
                                class="form-control"
                                id="email_id"
                          name="email_id"
                          
                                placeholder="admin@bni.com"
                              />
                            </div>

                             <!-- Modals -->
                        <!-- One Year Tax Modal -->
                        <div
                        class="modal fade"
                        id="taxModal1"
                        tabindex="-1"
                        aria-labelledby="taxModalLabel"
                        aria-hidden="true"
                      >
                        <div class="modal-dialog">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title" id="taxModalLabel">
                                Select Tax Type
                              </h5>
                              <button
                                type="button"
                                class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="Close"
                              ></button>
                            </div>
                            <div class="modal-body">
                              <label for="taxType1">Tax Type:</label>
                              <select
                                class="form-control"
                                id="taxType1"
                                onchange="updateTaxOptions(1)"
                              >
                                <option value="" disabled selected>
                                  Select Tax Type
                                </option>
                                <option value="gst">GST</option>
                                <option value="vat">VAT</option>
                              </select>

                              <label for="taxOptions1" class="mt-2"
                                >Tax Percentage:</label
                              >
                              <select
                                class="form-control"
                                id="taxOptions1"
                                disabled
                              >
                                <option value="" selected>
                                  Select Percentage
                                </option>
                              </select>

                              <div
                                class="add-button-container"
                                id="addButtonContainer1"
                              >
                                <button
                                  class="btn btn-success"
                                  id="addButton1"
                                >
                                  Add
                                </button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Two Year Tax Modal -->
                      <div
                        class="modal fade"
                        id="taxModal2"
                        tabindex="-1"
                        aria-labelledby="taxModalLabel"
                        aria-hidden="true"
                      >
                        <div class="modal-dialog">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title" id="taxModalLabel">
                                Select Tax Type for Two Year Membership
                              </h5>
                              <button
                                type="button"
                                class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="Close"
                              ></button>
                            </div>
                            <div class="modal-body">
                              <label for="taxType2">Tax Type:</label>
                              <select
                                class="form-control"
                                id="taxType2"
                                onchange="updateTaxOptions(2)"
                              >
                                <option value="" disabled selected>
                                  Select Tax Type
                                </option>
                                <option value="gst">GST</option>
                                <option value="vat">VAT</option>
                              </select>

                              <label for="taxOptions2" class="mt-2"
                                >Tax Percentage:</label
                              >
                              <select
                                class="form-control"
                                id="taxOptions2"
                                disabled
                              >
                                <option value="" selected>
                                  Select Percentage
                                </option>
                              </select>

                              <div
                                class="add-button-container"
                                id="addButtonContainer2"
                              >
                                <button
                                  class="btn btn-success"
                                  id="addButton2"
                                >
                                  Add
                                </button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Five Year Tax Modal -->
                      <div
                        class="modal fade"
                        id="taxModal3"
                        tabindex="-1"
                        aria-labelledby="taxModalLabel"
                        aria-hidden="true"
                      >
                        <div class="modal-dialog">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title" id="taxModalLabel">
                                Select Tax Type for Five Year Membership
                              </h5>
                              <button
                                type="button"
                                class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="Close"
                              ></button>
                            </div>
                            <div class="modal-body">
                              <label for="taxType3">Tax Type:</label>
                              <select
                                class="form-control"
                                id="taxType3"
                                onchange="updateTaxOptions(3)"
                              >
                                <option value="" disabled selected>
                                  Select Tax Type
                                </option>
                                <option value="gst">GST</option>
                                <option value="vat">VAT</option>
                              </select>

                              <label for="taxOptions3" class="mt-2"
                                >Tax Percentage:</label
                              >
                              <select
                                class="form-control"
                                id="taxOptions3"
                                disabled
                              >
                                <option value="" selected>
                                  Select Percentage
                                </option>
                              </select>

                              <div
                                class="add-button-container"
                                id="addButtonContainer3"
                              >
                                <button
                                  class="btn btn-success"
                                  id="addButton3"
                                >
                                  Add
                                </button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                            


                            <div class="col-xl-6">
                              <label for="eoi_link" class="form-label">Chapter EOI Link</label>
                              <input
                                  type="text"
                                  class="form-control"
                                  id="eoi_link"
                                  name="eoi_link"
                                  
                                  placeholder="https://-.."
                                  readonly
                              />
                          </div>
                            
<div class="col-xl-6">
  <label for="member_app_link" class="form-label">Member Application Link</label>
  <input type="text" class="form-control" id="member_app_link"
  name="member_app_link"
   placeholder="https://-.." readonly />
</div>



<div class="col-xl-6">
  <label for="chapter_mission" class="form-label"
    >Chapter Mission</label
  >
  <textarea
    class="form-control"
    id="chapter_mission"
                          name="chapter_mission"
                          
    placeholder="Enter the chapter's mission"
    rows="3"
  ></textarea>
</div>

<div class="col-xl-6">
  <label for="chapter_vision" class="form-label"
    >Chapter Vision</label
  >
  <textarea
    class="form-control"
    id="chapter_vision"
                          name="chapter_vision"
                          
    placeholder="Enter the chapter's vision"
    rows="3"
  ></textarea>
</div>
<div class="col-xl-6">
  <label for="billing_frequency" class="form-label">Kitty Billing Frequency <a href="/r/add-region">
  </a></label>
  <select class="form-control" name="billing_frequency" id="billing_frequency">
    <option value="">Select</option>
    <option value="weekly">Weekly</option>
    <option value="monthly">Monthly</option>
    <option value="quartely">Quartely</option>
    <option value="half_yearly">Half Yearly</option>
    <option value="yearly">Yearly</option>

  </select>
</div>

<div class="col-xl-6">
  <label for="chapter_kitty_fees" class="form-label"
    >Chapter Meeting/Kitty Fees <span style="color: #d01f2f;">(Weekly)</span> </label
  >
  <input
    type="text"
    class="form-control"
    id="chapter_kitty_fees"
    name="chapter_kitty_fees"
    
    placeholder="17,700/-.."
  />
  <!-- <div class="form-check mt-2">
    <input
      type="checkbox"
      class="form-check-input"
      id="taxable1"
      data-bs-toggle="modal"
      data-bs-target="#taxModal1"
    />
    <label
      class="form-check-label"
      for="taxable1"
      style="color: red"
      >Taxable?</label
    >
  </div> -->
</div>
<div class="col-xl-6">
  <label for="chapter_visitor_fees" class="form-label"
    >Chapter Visitor Fee</label
  >
  <input
    type="text"
    class="form-control"
    id="chapter_visitor_fees"
    name="chapter_visitor_fees"
    
    placeholder="1,200/-.."
  />
  <!-- <div class="form-check mt-2">
    <input
      type="checkbox"
      class="form-check-input"
      id="taxable1"
      data-bs-toggle="modal"
      data-bs-target="#taxModal1"
    />
    <label
      class="form-check-label"
      for="taxable1"
      style="color: red"
      >Taxable?</label
    >
  </div> -->
</div>

<div class="col-xl-6">
  <label for="chapter_status" class="form-label"
    >Chapter Status</label
  >
  <select
    class="form-control"
    data-trigger=""
    id="chapter_status"
    name="chapter_status"
   
  >
    <option value="">Select</option>
  </select>
</div>

<div class="col-xl-6">
  <label for="chapter_logo" class="form-label"
    >Chapter Logo <span style="color: red;">(jpg, png, jpeg)</span></label
  >
  <input
    type="file"
    class="form-control"
    id="chapter_logo"
    name="chapter_logo"
    
  />
</div>
                            
                            
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-xl-12">
              <div class="card custom-card">
                <div class="card-body add-products">
                  <div class="row gx-4">
                    <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-6">
                      <div class="card custom-card shadow-none mb-0 border-0">
                        <div class="card-body p-0">
                          <div class="row gy-3">
                            <div class="col-xl-12">
                              <label for="product-cost-add" class="form-label"
                                ><span style="font-size: 15px"
                                  ><b>Address & Hotel Details</b></span
                                ></label
                              >
                            </div>
      
                            <div class="col-xl-6">
                              <label for="country" class="form-label"
                                >Country</label
                              >
                              <select
                                class="form-control"
                                name="product-brand-add"
                                id="country"
                          name="country"
                          
                              >
                                <option value="">Select Country</option>
                              </select>
                            </div>
      
                            <div class="col-xl-6">
                              <label for="state" class="form-label"
                                >State/Province</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="state"
                          name="state"
                          
                                placeholder="Enter state or province"
                              />
                            </div>
      
                            <div class="col-xl-6">
                              <label for="city" class="form-label">City</label>
                              <input
                                type="text"
                                class="form-control"
                                id="city"
                          name="city"
                          
                                placeholder="Enter city"
                              />
                            </div>
      
                            <div class="col-xl-6">
                              <label for="meeting_hotel_name" class="form-label"
                                >Hotel Name</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="meeting_hotel_name"
                                name="meeting_hotel_name"
                                
                                placeholder="Vivanta by Taj.."
                              />
                            </div>
      
                            <div class="col-xl-6">
                              <label for="street_address_line" class="form-label"
                                >Street Address Line</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="street_address_line"
                          name="street_address_line"
                          
                                placeholder="Enter street address"
                              />
                            </div>
      
                            <div class="col-xl-6">
                              <label for="postal_code" class="form-label"
                                >Postal Code</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="postal_code"
                          name="postal_code"
                          
                                placeholder="Enter postal code"
                              />
                            </div>
                            <!-- <div class="col-12">
                              <button class="btn btn-danger btn-sm me-2 mb-2 mb-sm-0" id="chapter_location_note">
                                Add Note<i class="bi bi-plus-lg ms-2"></i>
                              </button>
                            </div> -->

                            <div id="locationNoteContainer" class="col-12 mt-3"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-xl-12">
              <div class="card custom-card">
                <div class="card-body add-products">
                  <div class="row gx-4">
                    <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-6">
                      <div class="card custom-card shadow-none mb-0 border-0">
                        <div class="card-body p-0">
                          <div class="row gy-3">
                            <div class="col-xl-12">
                              <label for="product-cost-add" class="form-label"
                                ><span style="font-size: 15px"
                                  ><b>Social Media & Handles</b></span
                                ></label
                              >
                            </div>
                            <div class="col-xl-6">
                              <label for="chapter_facebook-link" class="form-label">
                                <i class="bi bi-facebook"></i> Facebook
                              </label>
                              <input
                                type="text"
                                class="form-control"
                                id="chapter_facebook"
                          name="chapter_facebook"
                          
                                placeholder="www.facebook.com"
                              />
                            </div>
      
                            <div class="col-xl-6">
                              <label for="chapter_instagram-link" class="form-label">
                                <i class="bi bi-instagram"></i>
                                Instagram
                              </label>
                              <input
                                type="text"
                                class="form-control"
                                id="chapter_instagram"
                          name="chapter_instagram"
                          
                                placeholder="www.instagram.com"
                              />
                            </div>
      
                            <div class="col-xl-4">
                              <label for="chapter_linkedin-link" class="form-label">
                                <i class="bi bi-linkedin"></i>
                                Linkedin
                              </label>
                              <input
                                type="text"
                                class="form-control"
                                id="chapter_linkedin"
                          name="chapter_linkedin"
                          
                                placeholder="www.linkedin.com"
                              />
                            </div>
      
                            <div class="col-xl-4">
                              <label for="chapter_youtube" class="form-label">
                                <i class="bi bi-youtube"></i>
                                Youtube
                              </label>
                              <input
                                type="text"
                                class="form-control"
                                id="chapter_youtube"
                          name="chapter_youtube"
                          
                                placeholder="www.youtube.com"
                              />
                            </div>
      
                            <div class="col-xl-4">
                              <label for="chapter_website" class="form-label">
                                <i class="bi bi-https"></i>
                                Chapter Website (If any)
                              </label>
                              <input
                                type="text"
                                class="form-control"
                                id="chapter_website"
                          name="chapter_website"
                          
                                placeholder="www.yourwebsite.com"
                              />
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-xl-12">
              <div class="card custom-card">
                <div class="card-body add-products">
                  <div class="row gx-4">
                    <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-6">
                      <div class="card custom-card shadow-none mb-0 border-0">
                        <div class="card-body p-0">
                          <div class="row gy-3">
                            <div class="col-xl-12">
                              <label for="product-cost-add" class="form-label"
                                ><span style="font-size: 15px"
                                  ><b>Membership Fees Details <span style="color: #d01f2f;">(By Region)</span></b></span
                                ></label
                              >
                            </div>

                            <div class="col-xl-6">
                              <label for="one_time_registration_fee" class="form-label">One Time Registration Fees</label>
                              <input
                                type="text"
                                class="form-control"
                                id="one_time_registration_fee"
                                name="one_time_registration_fee"
                                
                                placeholder="5,000/-"
                                readonly
                                style="background-color: rgb(240, 240, 240);"
                              />
                            </div>
                            <div class="col-xl-6">
                              <label for="chapter_late_fees" class="form-label">Late Fees</label>
                              <input
                                type="text"
                                class="form-control"
                                id="chapter_late_fees"
                                name="chapter_late_fees"
                                
                                placeholder="Enter late fees"
                                readonly
                                style="background-color: rgb(240, 240, 240);"
                              />
                            </div>
                            <div class="col-xl-4">
                              <label for="chapter_membership_fee" class="form-label">One Year Membership Fees</label>
                              <input
                                type="text"
                                class="form-control"
                                id="chapter_membership_fee"
                                name="chapter_membership_fee"
                                
                                placeholder="59,900/-"
                                readonly
                                style="background-color: rgb(240, 240, 240);"
                              />
                            </div>
                            <div class="col-xl-4">
                              <label for="chapter_membership_fee_two_year" class="form-label">Two Year Membership Fees</label>
                              <input
                                type="text"
                                class="form-control"
                                id="chapter_membership_fee_two_year"
                                name="chapter_membership_fee_two_year"
                                
                                placeholder="69,000/-"
                                readonly
                                style="background-color: rgb(240, 240, 240);"
                              />
                            </div>
                            <div class="col-xl-4">
                              <label for="chapter_membership_fee_five_year" class="form-label">Five Year Membership Fees</label>
                              <input
                                type="text"
                                class="form-control"
                                id="chapter_membership_fee_five_year"
                                name="chapter_membership_fee_five_year"
                                
                                placeholder="1,03,500/-"
                                readonly
                                style="background-color: rgb(240, 240, 240);"
                              />
                            </div>

                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card-footer border-top border-block-start-dashed d-sm-flex justify-content-end align-items-center">
                  <div class="me-3">
                    <label for="date_of_publishing" class="form-label mb-0 me-2"><b>Date of Publishing</b>:</label>
                    <input type="date" class="form-control d-inline-block w-auto" id="date_of_publishing"
                    name="date_of_publishing"
                     />
                  </div>
                  <div class="me-3">
                    <label for="chapter_launched_by" class="form-label mb-0 me-2"><b>Chapter Launched by</b>:</label>
                    <input type="text" class="form-control d-inline-block w-auto" id="chapter_launched_by"
                    name="chapter_launched_by"
                    
                           placeholder="Chapter launched by.." />
                  </div>
                  
                  <button class="btn btn-success me-2 mb-2 mb-sm-0">
                    Add Chapter
                  </button>
                </div>
              </div>
            </div>
          </div>
        </form>
        <div id="formMessage"></div>
        </div>
      </div>
      <!-- End::content  -->

      <script>
        document.addEventListener("DOMContentLoaded", function() {
  const regionsApiUrl = 'https://bni-data-backend.onrender.com/api/regions';
  const accoladesApiUrl = 'https://bni-data-backend.onrender.com/api/accolades';
  const chapterNameInput = document.getElementById('chapter_name');
  const regionSelect = document.getElementById('region_id');
  const eoiLinkInput = document.getElementById('eoi_link');
  const memberAppLinkInput = document.getElementById('member_app_link');
  const chapterMeetingDaySelect = document.getElementById('chapter_meeting_day');
  const chapterStatusSelect = document.getElementById('chapter_status');
  const chapterTypeSelect = document.getElementById('chapter_type');  // Add chapter type dropdown
  const oneTimeRegistrationFeeInput = document.getElementById('one_time_registration_fee');
  const chapterLateFeesInput = document.getElementById('chapter_late_fees');
  const chapterMembershipFeeInput = document.getElementById('chapter_membership_fee');
  const chapterMembershipFeeTwoYearInput = document.getElementById('chapter_membership_fee_two_year');
  const chapterMembershipFeeFiveYearInput = document.getElementById('chapter_membership_fee_five_year');
  let accoladesMap = {};  // Mapping accolade_id to accolade_name
  let regionsData = [];   // Store fetched regions data

  // Fetch accolade data and build a mapping of accolade_id to accolade_name
  fetch(accoladesApiUrl)
    .then(response => response.json())
    .then(accoladesData => {
      accoladesData.forEach(accolade => {
        accoladesMap[accolade.accolade_id] = accolade.accolade_name;
      });
    })
    .catch(error => {
      console.error('Error fetching accolades:', error);
    });

  // Fetch regions data
  fetch(regionsApiUrl)
    .then(response => response.json())
    .then(data => {
      regionsData = data; // Store the data for later use
      regionSelect.innerHTML = '<option value="">Select</option>';
      
      // Loop through each region and create an <option> for it
      data.forEach(region => {
        const option = document.createElement('option');
        option.value = region.region_id;
        option.textContent = region.region_name;
        option.dataset.accolades = JSON.stringify(region.accolades_config);
        option.dataset.daysOfChapter = JSON.stringify(region.days_of_chapter); // Store days_of_chapter in dataset
        option.dataset.chapterStatus = region.chapter_status;  // Store chapter_status in dataset
        option.dataset.chapterType = JSON.stringify(region.chapter_type);      // Store chapter_type in dataset
        regionSelect.appendChild(option);
      });
    })
    .catch(error => {
      console.error('Error fetching regions:', error);
    });

  // Function to generate EOI link
  function generateEoiLink() {
    const chapterName = chapterNameInput.value.trim();
    const selectedRegion = regionSelect.options[regionSelect.selectedIndex];

    if (selectedRegion) {
      const regionName = selectedRegion.textContent;
      const firstLetterOfRegion = regionName.charAt(0).toLowerCase(); // Get the first letter of the region name
      eoiLinkInput.value = `https://www.bniindia.li/${chapterName}-del-${firstLetterOfRegion}`;
    } else {
      eoiLinkInput.value = ''; // Clear the link if no region is selected
    }
  }

  // Function to generate Member App link
  function generateMemberAppLink() {
    const chapterName = chapterNameInput.value.trim();
    const selectedRegion = regionSelect.options[regionSelect.selectedIndex];
    
    if (selectedRegion) {
      const regionName = selectedRegion.textContent;
      const firstLetterOfRegion = regionName.charAt(0).toLowerCase(); // Get the first letter of the region name
      memberAppLinkInput.value = `https://www.bniindia.li/${chapterName}-del-${firstLetterOfRegion}-ma`;
    } else {
      memberAppLinkInput.value = ''; // Clear the link if no region is selected
    }
  }

  // Event listeners for input changes
  chapterNameInput.addEventListener('input', function() {
    generateEoiLink();
    generateMemberAppLink();
  });

  regionSelect.addEventListener('change', function() {
    generateEoiLink();
    generateMemberAppLink();

    const selectedRegionId = this.value;
    chapterMeetingDaySelect.innerHTML = '<option value="">Select</option>';  // Clear previous options
    chapterStatusSelect.innerHTML = '<option value="">Select</option>';      // Clear previous status options
    chapterTypeSelect.innerHTML = '<option value="">Select</option>';        // Clear previous type options

    if (selectedRegionId) {
      // Find the selected region in the stored regionsData
      const selectedRegion = regionsData.find(region => region.region_id == selectedRegionId);

      if (selectedRegion) {
        // Populate the Chapter Meeting Day dropdown
        const daysOfChapter = selectedRegion.days_of_chapter; // Access days_of_chapter directly from the selected region
        if (Array.isArray(daysOfChapter) && daysOfChapter.length > 0) {
          daysOfChapter.forEach(day => {
            const option = document.createElement('option');
            option.value = day;  // Assuming the day is a string, adjust if necessary
            option.textContent = day; // Display the day name
            chapterMeetingDaySelect.appendChild(option);
          });
        } else {
          console.warn('No days_of_chapter found or it is not an array');
        }

        // Populate the Chapter Status dropdown
        const chapterStatusString = selectedRegion.chapter_status;  // Access chapter_status directly from the selected region
        if (chapterStatusString) {
          // Remove curly braces and split the string into an array by commas
          const chapterStatusArray = chapterStatusString.replace(/[{}]/g, '').split(',');

          if (Array.isArray(chapterStatusArray) && chapterStatusArray.length > 0) {
            chapterStatusArray.forEach(status => {
              const option = document.createElement('option');
              option.value = status.trim();  // Trim any extra spaces around the status
              option.textContent = status.trim();  // Display the status
              chapterStatusSelect.appendChild(option);
            });
          } else {
            console.warn('No chapter_status found or it is not an array');
          }
        }

        // Populate the Chapter Type dropdown
        const chapterType = selectedRegion.chapter_type;  // Access chapter_type directly from the selected region
        if (Array.isArray(chapterType) && chapterType.length > 0) {
          chapterType.forEach(type => {
            const option = document.createElement('option');
            option.value = type;  // Assuming the type is a string, adjust if necessary
            option.textContent = type;  // Display the type
            chapterTypeSelect.appendChild(option);
          });
        } else {
          console.warn('No chapter_type found or it is not an array');
        }

        oneTimeRegistrationFeeInput.value = selectedRegion.one_time_registration_fee || '';
        chapterLateFeesInput.value = selectedRegion.late_fees || '';
        chapterMembershipFeeInput.value = selectedRegion.one_year_fee || '';
        chapterMembershipFeeTwoYearInput.value = selectedRegion.two_year_fee || '';
        chapterMembershipFeeFiveYearInput.value = selectedRegion.five_year_fee || '';
      }
    }
  });

  // Listen for region selection changes for accolades
  regionSelect.addEventListener('change', function() {
    const selectedOption = this.options[this.selectedIndex];
    const accoladesConfig = selectedOption.dataset.accolades;

    const accoladesContainer = document.getElementById('accolades-container');
    const accoladesList = document.getElementById('accolades-list');

    if (accoladesConfig && accoladesConfig !== '[]') {
      const accolades = JSON.parse(accoladesConfig);
      accoladesContainer.style.display = 'block';
      accoladesList.innerHTML = '';

      // Populate the accolade checkboxes
      accolades.forEach(accoladeId => {
        const accoladeDiv = document.createElement('div');
        accoladeDiv.style.marginBottom = '5px';

        const accoladeCheckbox = document.createElement('input');
        accoladeCheckbox.type = 'checkbox';
        accoladeCheckbox.checked = true;  // Checked by default
        accoladeCheckbox.disabled = true;  // Non-editable
        accoladeCheckbox.id = 'accolade-' + accoladeId;

        const accoladeLabel = document.createElement('label');
        accoladeLabel.htmlFor = 'accolade-' + accoladeId;
        accoladeLabel.textContent = accoladesMap[accoladeId] || `Accolade ${accoladeId}`;

        accoladeDiv.appendChild(accoladeCheckbox);
        accoladeDiv.appendChild(accoladeLabel);
        accoladesList.appendChild(accoladeDiv);
      });
    } else {
      accoladesContainer.style.display = 'none';
    }
  });
});

      </script>
      

<script>
  function updateTaxOptions(modalId) {
    const taxTypeSelect = document.getElementById(`taxType${modalId}`);
    const taxOptionsSelect = document.getElementById(`taxOptions${modalId}`);
    const addButtonContainer = document.getElementById(
      `addButtonContainer${modalId}`
    );
    const addButton = document.getElementById(`addButton${modalId}`);

    // Clear previous options
    taxOptionsSelect.innerHTML =
      '<option value="" selected>Select Percentage</option>';

    if (taxTypeSelect.value === "gst") {
      taxOptionsSelect.innerHTML +=
        '<option value="5">5%</option><option value="12">12%</option><option value="18">18%</option>';
    } else if (taxTypeSelect.value === "vat") {
      taxOptionsSelect.innerHTML +=
        '<option value="5">5%</option><option value="15">15%</option>';
    }

    // Enable the tax options dropdown
    taxOptionsSelect.disabled = false;

    // Show the Add button only if both dropdowns have a selected value
    addButtonContainer.style.display =
      taxTypeSelect.value && taxOptionsSelect.value ? "block" : "none";

    // Event listener for taxOptions dropdown to show/hide Add button
    taxOptionsSelect.addEventListener("change", function () {
      addButtonContainer.style.display =
        taxTypeSelect.value && taxOptionsSelect.value ? "block" : "none";
    });
  }

  // Bootstrap JS
</script>

<script>
  // Handle the "Add Location Note" button click event
  document.getElementById('chapter_location_note').addEventListener('click', function() {
    // Create a new div to hold the textarea and buttons
    const noteDiv = document.createElement('div');
    noteDiv.className = 'd-flex align-items-center mb-2';

    // Create the textarea input
    const textArea = document.createElement('textarea');
    textArea.className = 'form-control me-2';
    textArea.placeholder = 'Enter location note...';
    textArea.rows = 3;

    // Create the tick button (save button)
    const saveButton = document.createElement('button');
    saveButton.className = 'btn btn-success btn-sm me-2';
    saveButton.innerHTML = '✔'; // Tick icon

    // Create the cancel button (X button)
    const cancelButton = document.createElement('button');
    cancelButton.className = 'btn btn-danger btn-sm';
    cancelButton.innerHTML = '✖'; // X icon

    // Append textarea and buttons to the noteDiv
    noteDiv.appendChild(textArea);
    noteDiv.appendChild(saveButton);
    noteDiv.appendChild(cancelButton);

    // Append the noteDiv to the container
    document.getElementById('locationNoteContainer').appendChild(noteDiv);

    // Handle the save (tick) button functionality
    saveButton.addEventListener('click', function() {
      // Handle the logic to save the note (e.g., send the note value to the database)
      const noteValue = textArea.value;
      alert('Location Note Saved: ' + noteValue);
      // You can replace the alert with your actual database-saving logic.
    });

    // Handle the cancel (X) button functionality
    cancelButton.addEventListener('click', function() {
      // Remove the noteDiv when the cancel button is clicked
      noteDiv.remove();
    });
  });
</script>

<script>
  document.getElementById("addChapterForm").addEventListener("submit", async function (event) {
    event.preventDefault();  // Prevent form from submitting normally
  
    const formData = new FormData(this);
    const formDataObj = {};
  
    formDataObj['chapterDays'] = [];
    formDataObj['chapterStatus'] = [];  // For Chapter Status
    formDataObj['chapterType'] = [];    // For Chapter Type
    formDataObj['accolades_config'] = [];      // For Accolades
  
    formData.forEach((value, key) => {
      if (key === 'chapterDays[]') {
        formDataObj['chapterDays'].push(value);
      } else if (key === 'chapterStatus[]') {  // Collect Chapter Status
        formDataObj['chapterStatus'].push(value);
      } else if (key === 'chapterType[]') {    // Collect Chapter Type
        formDataObj['chapterType'].push(value);
      } else if (key === 'accolades[]') {      // Collect Accolades
        formDataObj['accolades_config'].push(value);
      } else {
        formDataObj[key] = value;  // Handle other fields
      }
    });

      // Validate fields
  const contactNumber = formDataObj['contact_number']; // Adjust field name as per your form
  const email = formDataObj['email_id']; // Adjust field name as per your form
  const logo = document.getElementById('chapter_logo').files[0]; // Assuming regionLogo is the file input ID

  // Contact number validation
  if (!/^\d{10}$/.test(contactNumber)) {
    toastr.error("Contact number must be exactly 10 digits.");
    return;
  }

  // Email validation
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    toastr.error("Please enter a valid email address.");
    return;
  }

  // Logo file validation
  if (logo) {
    const validExtensions = ['image/jpeg', 'image/png', 'image/jpg'];
    if (!validExtensions.includes(logo.type)) {
      toastr.error("Logo must be in JPG, JPEG, or PNG format.");
      return;
    }
  } else {
    toastr.error("Please upload a region logo.");
    return;
  }
  
    try {
      const response = await fetch('https://bni-data-backend.onrender.com/api/chapters', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataObj),
      });
  
      const result = await response.json();
      if (response.ok) {
        toastr.success('Chapter added successfully!');
        document.getElementById("formMessage").innerText = "Chapter added successfully!";
        setTimeout(() => {
                  window.location.href = '/c/manage-chapter';  // Redirect to the region page
              }, 1200);
      } else {
        document.getElementById("formMessage").innerText = `Error: ${result.message}`;
        toastr.error( result.message);
      }
    } catch (error) {
      console.error("Error submitting the form:", error);
      toastr.error( error.message);
      document.getElementById("formMessage").innerText = "An error occurred. Please try again.";
    }
  });
  </script>
  <script src="../../assets/js/country.js"></script>

<%- include('../partials/footer') %> 
    
  
