 <!-- header -->
 <%- include('../partials/header') %> 
 <!-- end header -->

 <!-- sidebar -->

 <%- include('../partials/sidebar') %>

 <style>
  /* Hide the default select dropdown arrow */
  .custom-select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
  }

  /* Remove padding for better alignment */
  .custom-select {
    padding-right: 0;
    background: none;
  }

  .whatsapp-icon {
  color: green; /* Set your desired green color */
}


</style>

 <!-- end sidebar -->

      <!-- Start::app-content -->
      <div class="main-content app-content" style="background-color: #f4f4f4">
        <div class="container-fluid">
          <!-- Start::page-header -->
          <div
            class="d-flex align-items-center justify-content-between page-header-breadcrumb flex-wrap gap-2"
          >
            <div>
              <h1 class="page-title fw-medium fs-18 mb-0">
                <span style="font-weight: 700; font-family: Poppins"
                  >Add New Member</span
                > <br>
				
              </h1>
              <!-- <p>Manage kitty payments with just one click</p> -->
            </div>
            <div class="btn-list">
              <button class="btn btn-danger btn-wave me-0">
                <i class="ri-share-forward-line me-1"></i> Bulk Upload Members
              </button>
            </div>
            <!-- <div class="d-flex align-items-center gap-2 flex-wrap">
              <div class="form-group">
                <div class="input-group">
                  <div class="input-group-text bg-white border">
                    <i class="ri-calendar-line"></i>
                  </div>
                  <input
                    type="text"
                    class="form-control breadcrumb-input"
                    id="daterange"
                    placeholder="Search By Date Range"
                  />
                </div>
              </div>
              <div class="btn-list">
                <button class="btn btn-white btn-wave">
                  <i class="ri-filter-3-line align-middle me-1 lh-1"></i> Filter
                </button>
                <button class="btn btn-primary btn-wave me-0">
                  <i class="ri-share-forward-line me-1"></i> Share
                </button>
              </div>
            </div> -->
          </div>
          <!-- End::page-header -->
          <style>
            @import url("https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap");

            @import url("https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
          </style>

          <style>
            * {
              font-family: Montserrat !important;
              font-weight: 800px;
            }
            .text-muted {
              color: black !important;
              font-family: Montserrat Alternates;
            }
            .popins {
              font-family: Poppins;
            }
          </style>
          <form id="addMemberForm">
          <div class="row">
            <div class="col-xl-12">
              <div class="card custom-card">
                <div class="card-body add-products">
                  <div class="row gx-4">
                    <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-6">
                      <div class="card custom-card shadow-none mb-0 border-0">
                        <div class="card-body p-0">
                          <div class="row gy-3">
                            <div class="col-xl-12">
                              <label for="product-cost-add" class="form-label"
                                ><span style="font-size: 15px;"
                                  ><b>It's time for a new member!</b></span
                                ></label
                              >
                            </div>
                            
                            <div class="col-xl-6">
                              <label for="member_first_name" class="form-label">
                                First Name *
                              </label>
                              <div class="input-group">
                                <span class="input-group-text">
                                  <select class="form-select border-0 p-0 custom-select" id="memberPrefix" name="member_prefix" style="width: auto;">
                                    <option value="Mr.">Mr.</option>
                                    <option value="Mrs.">Mrs.</option>
                                    <option value="Ms.">Ms.</option>
                                    <option value="Dr.">Dr.</option>
                                    <option value="Prof.">Prof.</option>
                                  </select>
                                </span>
                                <input type="text" class="form-control" placeholder="Enter first name" id="member_first_name"
                                name="member_first_name"
                                required />
                              </div>
                              <label for="memberFirstName" class="form-label mt-1 fs-12 fw-normal text-muted mb-0">
                                <span style="color: red"
                            >*Mention the acknowledged name of the member</span
                          ></label
                        >
                              </label>
                            </div>
                            
                            
                            <div class="col-xl-6">
                                <label for="member_last_name" class="form-label"
                                  >Last Name *</label
                                >
                                <input type="text" class="form-control" id="member_last_name"
                                name="member_last_name"
                                required placeholder="Enter Last Name" />
                             
                              </div>
                              <div class="col-xl-6">
                                <label for="gender" class="form-label">Gender</label>
                                <select class="form-select" id="gender"
                                name="gender"
                                required>
                                  <option value="male">Male</option>
                                  <option value="female">Female</option>
                                  <option value="neutral">Neutral</option>
                                </select>
                              </div>
                              
                              <div class="col-xl-6">
                                <label for="member_date_of_birth" class="form-label">Date of Birth *</label>
                                <input
                                  type="date"
                                  class="form-control"
                                  id="member_date_of_birth"
                                  name="member_date_of_birth"
                                  required
                                  onchange="validateDOB(this.value)"
                                  max="<%= new Date().toISOString().split('T')[0] %>"
                                />
                                <label for="memberFirstName" class="form-label mt-1 fs-12 fw-normal text-muted mb-0">
                                  <span style="color: #666"></span>
                                </label>
                              </div>
                              <div class="col-xl-6">
                                <label for="member_phone_number" class="form-label"
                                  >Contact Number <span style="color: red;">(Phone Number) *</span> </label
                                >
                                <div class="input-group">
                                  <span class="input-group-text">
                                    <img
                                      src="https://upload.wikimedia.org/wikipedia/en/4/41/Flag_of_India.svg"
                                      alt="India"
                                      width="20"
                                      style="margin-right: 5px"
                                    />
                                    91+
                                  </span>
                                  <input
                                    type="tel"
                                    class="form-control"
                                    id="member_phone_number"
                                  name="member_phone_number"
                                  required
                                    placeholder="Enter phone number"
                                  />
                                </div>
                                <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="whatsappCheckbox">
                                  <label for="whatsappCheckbox" class="form-label mt-1 fs-12 fw-normal text-muted mb-0">
                                    <span>
                                      <i class="bi bi-whatsapp whatsapp-icon"></i> This is my Whatsapp Number
                                    </span>
                                  </label>
                                  
                                </div>
                                
                              </div>
                              
                              <div class="col-xl-6">
                                <label for="member_alternate_mobile_number" class="form-label"
                                  >Alternate Contact Number *</label
                                >
                                <div class="input-group">
                                  <span class="input-group-text">
                                    <img
                                      src="https://upload.wikimedia.org/wikipedia/en/4/41/Flag_of_India.svg"
                                      alt="India"
                                      width="20"
                                      style="margin-right: 5px"
                                    />
                                    91+
                                  </span>
                                  <input
                                    type="tel"
                                    class="form-control"
                                    id="member_alternate_mobile_number"
                                  name="member_alternate_mobile_number"
                                  required
                                    placeholder="Enter Alternate phone number"
                                  />
                                </div>
                              </div>
                              <div class="col-xl-6">
                                <label for="member_email_address" class="form-label"
                                  >Email Address *</label
                                >
                                <input type="text" class="form-control" id="member_email_address"
                                name="member_email_address"
                                required placeholder="test@gmail.com" />
                                
                              </div>

                              <div class="col-xl-6">
                                <label for="member_photo" class="form-label">Member Photo</label>
                                <input 
                                  type="file" 
                                  class="form-control" 
                                  id="member_photo"
                                  name="member_photo"
                                  accept="image/png, image/jpeg, image/jpg"
                                  required
                                />
                              </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-xl-12">
              <div class="card custom-card">
                <div class="card-body add-products">
                  <div class="row gx-4">
                    <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-6">
                      <div class="card custom-card shadow-none mb-0 border-0">
                        <div class="card-body p-0">
                          <div class="row gy-3">
                            <div class="col-xl-12">
                              <label for="product-cost-add" class="form-label"
                                ><span style="font-size: 15px; color:#d01f2f;"
                                  ><b>Member Address Details</b></span
                                ></label
                              >
                            </div>
      
                            <div class="col-xl-6">
                              <label for="country" class="form-label"
                                >Country *</label
                              >
                              <select
                                class="form-control"
                                id="country"
                                  name="country"
                                  required
                              >
                                <option value="">Select Country</option>
                              </select>
                            </div>
      
                            <div class="col-xl-6">
                              <label for="address_state" class="form-label"
                                >State/Province *</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="address_state"
                                  name="address_state"
                                  required
                                placeholder="Enter state or province"
                              />
                            </div>
      
                            <div class="col-xl-6">
                              <label for="address_city" class="form-label">City *</label>
                              <input
                                type="text"
                                class="form-control"
                                id="address_city"
                                  name="address_city"
                                  required
                                placeholder="Enter city"
                              />
                            </div>
      
                            <div class="col-xl-6">
                              <label for="street_address_line_1" class="form-label"
                                >Street Address Line 1 *</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="street_address_line_1"
                                  name="street_address_line_1"
                                  required
                                placeholder="Enter street address"
                              />
                            </div>
      
                            <div class="col-xl-6">
                              <label for="street_address_line_2" class="form-label"
                                >Street Address Line 2</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="street_address_line_2"
                                  name="street_address_line_2"
                                  required
                                placeholder="Enter street address"
                              />
                            </div>
      
                            <div class="col-xl-6">
                              <label for="address_pincode" class="form-label"
                                >Postal Code *</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="address_pincode"
                                  name="address_pincode"
                                  required
                                placeholder="Enter postal code"
                              />
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-xl-12">
              <div class="card custom-card">
                <div class="card-body add-products">
                  <div class="row gx-4">
                    <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-6">
                      <div class="card custom-card shadow-none mb-0 border-0">
                        <div class="card-body p-0">
                          <div class="row gy-3">
                            <div class="col-xl-12">
                              <label for="product-cost-add" class="form-label"
                                ><span style="font-size: 15px; color:#d01f2f;"
                                  ><b>Member Company Details</b></span
                                ></label
                              >
                            </div>
                            <div class="col-xl-6">
                              <label for="member_gst_number" class="form-label"
                                >GSTIN Number *</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="member_gst_number"
                                  name="member_gst_number"
                                  required
                                placeholder="Enter GSTIN Number.."
                              />
                        
                            </div>

              <div class="col-xl-6">
                              <label for="member_company_name" class="form-label"
                                >Company Name *</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="member_company_name"
                                  name="member_company_name"
                                  required
                                placeholder="Enter Company Name.."
                              />
                        
                            </div>


              <div class="col-xl-6">
                              <label for="member_company_state" class="form-label"
                                >Company State *</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="member_company_state"
                                  name="member_company_state"
                                  required
                                placeholder="Enter Company State.."
                              />
                        
                            </div>

              <div class="col-xl-6">
                              <label for="member_company_city" class="form-label"
                                >Company City *</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="member_company_city"
                                  name="member_company_city"
                                  required
                                placeholder="Enter Company City.."
                              />
                        
                            </div>

                            <div class="col-xl-6">
                              <label for="member_company_address" class="form-label"
                                >Company Address *</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="member_company_address"
                                  name="member_company_address"
                                  required
                                placeholder="Enter Company Address.."
                              />
                        
                            </div>

                            <div class="col-xl-6">
                              <label for="member_company_pincode" class="form-label"
                                >Postal Code *</label
                              >
                              <input
                                type="text"
                                class="form-control"
                                id="member_company_pincode"
                                pattern="\d{6}" 
                                title="Please enter a 6-digit postal code."
                                  name="member_company_pincode"
                                  required
                                placeholder="Enter Postal Code.."
                              />
                        
                            </div>

                            <div class="col-xl-6">
                              <label for="member_company_logo" class="form-label">Company Logo</label>
                              <input 
                                type="file" 
                                class="form-control" 
                                id="member_company_logo"
                                name="member_company_logo"
                                accept="image/png, image/jpeg, image/jpg"
                                required
                              />
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-xl-12">
              <div class="card custom-card">
                <div class="card-body add-products">
                  <div class="row gx-4">
                    <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-6">
                      <div class="card custom-card shadow-none mb-0 border-0">
                        <div class="card-body p-0">
                          <div class="row gy-3">
                            <div class="col-xl-12">
                              <label for="product-cost-add" class="form-label"
                                ><span style="font-size: 15px; color: #d01f2f;"
                                  ><b>Member BNI Details</b></span
                                ></label
                              >
                            </div>
                            <div class="col-xl-6">
                              <label for="region_id" class="form-label">Choose Region <a href="/r/add-region">
                                <button type="button" class="btn btn-outline-info btn-sm">Add Region +</button>
                              </a></label>
                              <select class="form-control" name="region_id" id="region_id">
                                <option value="">Select Region</option>
                              </select>
                            </div>
                            
                            <div class="col-xl-6">
                              <label for="chapter_id" class="form-label">Choose Chapter <a href="/c/add-chapter">
                                <button type="button" class="btn btn-outline-info btn-sm">Add Chapter +</button>
                              </a></label>
                              <select class="form-control" name="chapter_id" id="chapter_id">
                                <option value="">Select Chapter</option>
                              </select>
                            </div>
                            
                            <div class="col-xl-6">
                              <label for="accolades_id" class="form-label">Accolades
                                <a href="/m/add-member">
                                  <button type="button" class="btn btn-outline-info btn-sm">Add Accolades +</button>
                                </a>
                              </label>
                              <div id="accoladesContainer"></div>
                            </div>
                            
                        
                              
                            <div class="col-xl-6">
                              <label for="product-brand-add" class="form-label">
                                  Choose Category/Classification
                                  <a href="add-category.html">
                                      <button type="button" class="btn btn-outline-info btn-sm">Add Category +</button>
                                  </a>
                              </label>
                              <select class="form-control" data-trigger="" name="category_id" id="category">
                                <option value="">Select</option>
                                <!-- Categories will be dynamically populated here -->
                            </select>
                            </div>
            
                             
                              <div class="col-xl-6">
                                <label for="member_current_membership" class="form-label">Choose Membership</label>
                                <select class="form-control" id="member_current_membership"
                                name="member_current_membership"
                                required>
                                  <option value="">Select Chapter</option>
                                  <option value="1">1 Year</option>
                                  <option value="2">2 Year</option>
                                  <option value="5">5 Year</option>
                                </select>
                              </div>

                              <div class="col-xl-6">
                                <label for="member_induction_date" class="form-label">Induction Date</label>
                                <input
                                  type="date"
                                  class="form-control"
                                  id="member_induction_date"
                                  name="member_induction_date"
                                  required
                                  onchange="calculateRenewalDate()"
                                />
                              </div>
                              
                              <div class="col-xl-6">
                                <label for="member_renewal_date" class="form-label">Renewal Date</label>
                                <input
                                  type="date"
                                  class="form-control"
                                  id="member_renewal_date"
                                  name="member_renewal_date"
                                  required
                                  readonly
                                />
                              </div>

                              <div class="col-xl-6">
                                <label for="meeting_opening_balance" class="form-label">Meeting Opening Balance</label>
                                <input
                                  type="text"
                                  class="form-control"
                                  id="meeting_opening_balance"
                                  name="meeting_opening_balance"
                                  placeholder="Any pending amount.."
                                />
                              </div>

                              <!-- <div class="col-xl-6">
                                <label for="product-cost-add" class="form-label"
                                  >Last Renewal Date</label
                                >
                                <input
                                  type="text"
                                  class="form-control"
                                  id="memberLastRenewalDate"
                                  placeholder="08.05.2024.."
                                  readonly
                                  style="background-color: gainsboro;"
                                />
                          
                              </div> -->
                              
                              <!-- <div class="col-xl-6">
                                <label for="memberStatus" class="form-label">Member Status</label>
                                <select class="form-control" name="memberStatus" id="memberStatus">
                                  <option value="">Select</option>
                                  <option value="active">Active</option>
                                  <option value="inactive">Inactive</option>
                                </select>
                              </div> -->
                              
                              
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
         
          <div class="row">
            <div class="col-xl-12">
              <div class="card custom-card">
                <div class="card-body">
                  <div class="d-flex align-items-center mb-3">
                    <div class="form-check form-switch">
                      <input 
                        class="form-check-input" 
                        type="checkbox" 
                        role="switch" 
                        id="showEmergencyContact" 
                        style="width: 3em; height: 1.5em; margin-right: 10px;"
                      >
                      <label class="form-check-label" for="showEmergencyContact">
                        <span style="font-size: 15px; color: #d01f2f;">
                          <i class="bi bi-shield-fill-plus me-1"></i>
                          <b>Add Emergency Contact Details</b>
                        </span>
                      </label>
                    </div>
                  </div>

                  <!-- Emergency Contact Details Section (initially hidden) -->
                  <div id="emergencyContactSection" style="display: none;">
                    <div class="row gy-3">
                      <div class="col-xl-4">
                        <label for="emergency_contact_name" class="form-label">
                          <i class="bi bi-person-fill me-1"></i> Emergency Contact Name
                        </label>
                        <input
                          type="text"
                          class="form-control"
                          id="emergency_contact_name"
                          name="emergency_contact_name"
                          placeholder="Enter contact name"
                        />
                      </div>

                      <div class="col-xl-4">
                        <label for="emergency_contact_number" class="form-label">
                          <i class="bi bi-telephone-fill me-1"></i> Emergency Contact Number
                        </label>
                        <input
                          type="tel"
                          class="form-control"
                          id="emergency_contact_number"
                          name="emergency_contact_number"
                          placeholder="Enter contact number"
                        />
                      </div>

                      <div class="col-xl-4">
                        <label for="emergency_contact_relation" class="form-label">
                          <i class="bi bi-people-fill me-1"></i> Relationship
                        </label>
                        <input
                          type="text"
                          class="form-control"
                          id="emergency_contact_relation"
                          name="emergency_contact_relation"
                          placeholder="Enter relationship"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
         
          <div class="row">
            <div class="col-xl-12">
              <div class="card custom-card">
                <div class="card-body add-products">
                  <div class="row gx-4">
                    <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-6">
                      <div class="card custom-card shadow-none mb-0 border-0">
                        <div class="card-body p-0">
                          <div class="row gy-3">
                            <div class="col-xl-12">
                              <label for="product-cost-add" class="form-label">
                                <span style="font-size: 15px; color: #d01f2f;">
                                  <b>Social Media & Handles</b> (Optional)
                                </span>
                              </label>
                            </div>
                            <div class="col-xl-6">
                              <label for="member_facebook" class="form-label">
                                <i class="bi bi-facebook"></i> Facebook
                              </label>
                              <input
                                type="text"
                                class="form-control"
                                id="member_facebook"
                                name="member_facebook"
                                placeholder="www.facebook.com"
                              />
                            </div>
      
                            <div class="col-xl-6">
                              <label for="member_instagram" class="form-label">
                                <i class="bi bi-instagram"></i>
                                Instagram
                              </label>
                              <input
                                type="text"
                                class="form-control"
                                id="member_instagram"
                                name="member_instagram"
                                placeholder="www.instagram.com"
                              />
                            </div>
      
                            <div class="col-xl-4">
                              <label for="member_linkedin" class="form-label">
                                <i class="bi bi-linkedin"></i>
                                Linkedin
                              </label>
                              <input
                                type="text"
                                class="form-control"
                                id="member_linkedin"
                                name="member_linkedin"
                                placeholder="www.linkedin.com"
                              />
                            </div>
      
                            <div class="col-xl-4">
                              <label for="member_youtube" class="form-label">
                                <i class="bi bi-youtube"></i>
                                Youtube
                              </label>
                              <input
                                type="text"
                                class="form-control"
                                id="member_youtube"
                                name="member_youtube"
                                placeholder="www.youtube.com"
                              />
                            </div>
      
                            <div class="col-xl-4">
                              <label for="member_website" class="form-label">
                                <i class="bi bi-https"></i>
                                Company Website (If any)
                              </label>
                              <input
                                type="text"
                                class="form-control"
                                id="member_website"
                                name="member_website"
                                placeholder="www.website.com"
                              />
                            </div>
                            <input type="hidden" id="member_status" name="member_status" value="active" />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row justify-content-center">
                  <div class="col-12 text-center">
                    <div class="form-check">
                      <div class="form-check">
                        <input class="form-check-input ml-120px" type="checkbox" id="notification_consent"
                        name="notification_consent"
                        required>
                      </div>
                      <label for="notification_consent" class="form-check-label">
                        I consent to receive notifications.
                      </label>
                    </div>
                  </div>
                </div>
              </div>
                
                
                <div class="card-footer border-top border-block-start-dashed d-sm-flex justify-content-end align-items-center">
                  <div class="me-3">
                    <label for="date_of_publishing" class="form-label mb-0 me-2"><b>Date of Publishing</b>:</label>
                    <input type="date" class="form-control d-inline-block w-auto" id="date_of_publishing"
                    name="date_of_publishing"
                    required />
                  </div>
                  <div class="me-3">
                    <label for="member_sponsored_by" class="form-label mb-0 me-2"><b>Member Sponsored by</b>:</label>
                    <input type="text" class="form-control d-inline-block w-auto" id="member_sponsored_by"
                    name="member_sponsored_by"
                    required
                           placeholder="Sunil Kuzhuvelil" />
                  </div>
                  
                  <button class="btn btn-success me-2 mb-2 mb-sm-0">
                    Add Member
                  </button>
                </div>
                
              </div>
            </div>
          </div>
        </form>
        <div id="formMessage"></div> 
        </div>
      </div>
      <!-- End::content  -->

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const regionsApiUrl = 'https://bni-data-backend.onrender.com/api/regions';
          const chaptersApiUrl = 'https://bni-data-backend.onrender.com/api/chapters';
          const accoladesApiUrl = 'https://bni-data-backend.onrender.com/api/accolades';
          const categoriesApiUrl = 'https://bni-data-backend.onrender.com/api/memberCategory'; // Categories API URL
          const categorySelect = document.getElementById('category');
      
          const regionSelect = document.getElementById('region_id');
          const chapterSelect = document.getElementById('chapter_id');
          const accoladesContainer = document.getElementById('accoladesContainer');
          const loader = document.getElementById('loader'); // Loader element
      
          let allChapters = []; // To store fetched chapters
          let allAccolades = []; // To store fetched accolades
      
          // Fetch and populate categories
          fetch(categoriesApiUrl)
            .then(response => response.json())
            .then(data => {
              if (data && data.length > 0) {
                categorySelect.innerHTML = '<option value="">Select Category</option>';
                data.forEach(category => {
                  const option = document.createElement('option');
                  option.value = category.category_id;
                  option.textContent = category.category_name;
                  categorySelect.appendChild(option);
                });
              } else {
                categorySelect.innerHTML = '<option value="">No Categories Available</option>';
              }
            })
            .catch(error => {
              console.error('Error fetching categories:', error);
              categorySelect.innerHTML = '<option value="">Error Loading Categories</option>';
            });
      
          // Fetch regions and populate the region dropdown
          fetch(regionsApiUrl)
            .then(response => response.json())
            .then(data => {
              regionSelect.innerHTML = '<option value="">Select Region</option>';
              data.forEach(region => {
                const option = document.createElement('option');
                option.value = region.region_id;
                option.setAttribute('data-accolades-config', region.accolades_config); // Store accolades config as data attribute
                option.textContent = region.region_name;
                regionSelect.appendChild(option);
              });
            })
            .catch(error => {
              console.error('Error fetching regions:', error);
            });
      
          // Fetch all chapters and store them
          fetch(chaptersApiUrl)
            .then(response => response.json())
            .then(data => {
              allChapters = data;
            })
            .catch(error => {
              console.error('Error fetching chapters:', error);
            });
      
          // Fetch all accolades and store them
          fetch(accoladesApiUrl)
            .then(response => response.json())
            .then(data => {
              allAccolades = data;
            })
            .catch(error => {
              console.error('Error fetching accolades:', error);
            });
      
          // Event listener to filter and display chapters and accolades based on selected region
          regionSelect.addEventListener('change', function () {
            const selectedRegionId = this.value;
            const selectedRegionAccolades = this.options[this.selectedIndex].getAttribute('data-accolades-config');
            chapterSelect.innerHTML = '<option value="">Select Chapter</option>';
            accoladesContainer.innerHTML = ''; // Clear accolades
            loader.style.display = 'flex'; // Show loader
      
            // Filter chapters by selected region
            const filteredChapters = allChapters.filter(chapter => chapter.region_id == selectedRegionId);
      
            if (filteredChapters.length > 0) {
              filteredChapters.forEach(chapter => {
                const option = document.createElement('option');
                option.value = chapter.chapter_id;
                option.textContent = chapter.chapter_name;
                chapterSelect.appendChild(option);
              });
            } else {
              chapterSelect.innerHTML = '<option value="">No Chapters Available</option>';
            }
      
            // Process accolades with Select All feature
            if (selectedRegionAccolades) {
              const accoladeIds = selectedRegionAccolades.split(',');
              accoladesContainer.innerHTML = ''; // Clear previous accolades
      
              // Add Select All checkbox first
              const selectAllDiv = document.createElement('div');
              selectAllDiv.className = 'form-check';
              selectAllDiv.innerHTML = `
                <input type="checkbox" class="form-check-input" id="selectAllAccolades">
                <label class="form-check-label" for="selectAllAccolades">
                    <strong>Select All Accolades</strong>
                </label>
              `;
              accoladesContainer.appendChild(selectAllDiv);
      
              // Add individual accolade checkboxes
              accoladeIds.forEach(id => {
                const accolade = allAccolades.find(a => a.accolade_id == id);
                if (accolade) {
                  const checkbox = document.createElement('div');
                  checkbox.className = 'form-check';
                  checkbox.innerHTML = `
                    <input type="checkbox" class="form-check-input accolade-checkbox" 
                           id="accolades_${accolade.accolade_id}" 
                           value="${accolade.accolade_id}">
                    <label class="form-check-label" for="accolades_${accolade.accolade_id}">
                        ${accolade.accolade_name}
                    </label>
                  `;
                  accoladesContainer.appendChild(checkbox);
                }
              });
      
              // Add Select All functionality
              const selectAllCheckbox = document.getElementById('selectAllAccolades');
              const accoladeCheckboxes = document.querySelectorAll('.accolade-checkbox');
      
              selectAllCheckbox.addEventListener('change', function() {
                console.log('Select All clicked:', this.checked);
                accoladeCheckboxes.forEach(checkbox => {
                  checkbox.checked = this.checked;
                });
              });
      
              // Update Select All when individual checkboxes change
              accoladeCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                  const allChecked = Array.from(accoladeCheckboxes)
                    .every(cb => cb.checked);
                  selectAllCheckbox.checked = allChecked;
                  console.log('Individual checkbox changed, all checked:', allChecked);
                });
              });
      
            } else {
              accoladesContainer.innerHTML = '<p>No Accolades Available</p>';
            }
      
            loader.style.display = 'none'; // Hide loader
          });
        });
      </script>


<script>
  function calculateRenewalDate() {
    const inductionDateValue = document.getElementById("member_induction_date").value;
    const membershipDuration = document.getElementById("member_current_membership").value; // Get membership duration
    if (!inductionDateValue || !membershipDuration) return;

    // Parse the date value in the correct format (YYYY-MM-DD)
    console.log("-=-=-=-=-= induction date", inductionDateValue);
    const [year, month, day] = inductionDateValue.split('-');
    const inductionDate = new Date(year, month - 1, day); // Create date object
    console.log("-=-=-=-=-= induction date -1 ", inductionDate);

    const dayOfMonth = inductionDate.getDate();
    let renewalMonth = inductionDate.getMonth();  // Start with induction month
    let renewalYear = inductionDate.getFullYear();  // Current year

    // If the day of the month is greater than 15, set renewal month to the next month
    if (dayOfMonth > 15) {
      renewalMonth += 1; // Increment month
    }

    // Increment the year based on membership duration and add an additional month
    const durationInYears = parseInt(membershipDuration);
    renewalYear += durationInYears; // Add the membership duration in years
    // renewalMonth += 1; // Add an additional month

    // Set the renewal date to the 1st of the calculated renewal month
    const renewalDate = new Date(renewalYear, renewalMonth, 1); // Day is always set to 1st

    console.log("========================== renewal date :", renewalDate);
    const renewalDateFormatted = `${renewalYear}-${String(renewalMonth + 1).padStart(2, '0')}-${String(1).padStart(2, '0')}`; // Format as YYYY-MM-DD
    console.log("Renewal Date:", renewalDateFormatted); // Log the formatted renewal date
    // Format the renewal date to YYYY-MM-DD for input display
    // const formattedRenewalDate = new Date(renewalDate.getTime() + (renewalDate.getTimezoneOffset() * 60000)).toISOString().split('T')[0];
    // console.log("--------------- format date", formattedRenewalDate);
    // document.getElementById("member_renewal_date").value = formattedRenewalDate;
    document.getElementById("member_renewal_date").value = renewalDateFormatted;

  }

  // Add event listener for membership selection
  document.getElementById("member_current_membership").addEventListener("change", calculateRenewalDate);
</script>

<script>
document.getElementById("addMemberForm").addEventListener("submit", async function(event) {
    event.preventDefault();
    console.log('🚀 Starting form submission');

    // Validate category selection
    const categorySelect = document.getElementById('category');
    if (!categorySelect.value) {
        toastr.error('Please select a category/classification');
        categorySelect.focus();
        return;
    }

    try {
        const formData = new FormData();
        
        // Get all form fields except files and accolades
        const formFields = new FormData(this);
        for (let [key, value] of formFields.entries()) {
            if (key !== 'member_photo' && key !== 'member_company_logo' && key !== 'accolades_id') {
                formData.append(key, value);
            }
        }

        // Handle accolades selection
        const selectedAccolades = Array.from(document.querySelectorAll('.accolade-checkbox:checked'))
            .map(checkbox => parseInt(checkbox.value));
        
        console.log('🏆 Selected accolades:', selectedAccolades);
        formData.append('accolades_id', JSON.stringify(selectedAccolades));

        // Handle files
        const memberPhoto = document.getElementById('member_photo').files[0];
        const companyLogo = document.getElementById('member_company_logo').files[0];

        if (memberPhoto) {
            console.log('📸 Adding member photo:', memberPhoto.name);
            formData.append('member_photo', memberPhoto);
        }

        if (companyLogo) {
            console.log('🏢 Adding company logo:', companyLogo.name);
            formData.append('member_company_logo', companyLogo);
        }

        // Log final form data
        console.log('📦 Final form data contents:');
        for (let [key, value] of formData.entries()) {
            if (value instanceof File) {
                console.log(`${key}: ${value.name} (${value.size} bytes)`);
            } else {
                console.log(`${key}: ${value}`);
            }
        }

        const response = await fetch('https://bni-data-backend.onrender.com/api/members', {
            method: 'POST',
            body: formData
        });

        if (!response.ok) {
            const contentType = response.headers.get("content-type");
            let errorMessage;
            if (contentType && contentType.includes("application/json")) {
                const errorData = await response.json();
                errorMessage = errorData.message || 'Unknown error occurred';
            } else {
                errorMessage = await response.text();
            }
            throw new Error(errorMessage);
        }

        const result = await response.json();
        console.log('✅ Success:', result);
        toastr.success('Member added successfully!');
        setTimeout(() => {
            window.location.href = '/m/manage-members';
        }, 1200);

    } catch (error) {
        console.error('❌ Error:', error);
        toastr.error(error.message || 'An error occurred while adding member');
    }
});

// Add visual feedback for category selection
document.getElementById('category').addEventListener('change', function() {
    if (this.value) {
        this.classList.remove('is-invalid');
        this.classList.add('is-valid');
    } else {
        this.classList.remove('is-valid');
        this.classList.add('is-invalid');
    }
});
</script>
  <script src="../../assets/js/country.js"></script>

<%- include('../partials/footer') %> 

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
// Only target the specific DOB input
const dobInput = document.getElementById('member_date_of_birth');

function calculateExactAge(birthDate) {
    const today = new Date();
    let years = today.getFullYear() - birthDate.getFullYear();
    let months = today.getMonth() - birthDate.getMonth();
    let days = today.getDate() - birthDate.getDate();

    // Adjust months and years if days are negative
    if (days < 0) {
        months--;
        // Get last day of previous month
        const lastMonth = new Date(today.getFullYear(), today.getMonth(), 0);
        days += lastMonth.getDate();
    }

    // Adjust years if months are negative
    if (months < 0) {
        years--;
        months += 12;
    }

    return { years, months, days };
}

function validateDOB(dob) {
    // Only proceed if the event is from the DOB input
    if (event.target.id !== 'member_date_of_birth') return true;

    const birthDate = new Date(dob);
    const today = new Date();
    
    // Calculate exact age
    const exactAge = calculateExactAge(birthDate);
    
    console.log("🎂 Age Calculation:", {
        years: exactAge.years,
        months: exactAge.months,
        days: exactAge.days,
        fullAge: `${exactAge.years} years, ${exactAge.months} months, ${exactAge.days} days`
    });

    // Check if birth year is before 1980
    if (birthDate.getFullYear() < 1980) {
        Swal.fire({
            icon: 'error',
            title: 'Age Restriction',
            text: 'Members must be born after 1980 to be eligible.',
            confirmButtonColor: '#d01f2f',
            confirmButtonText: 'Choose Different Date',
            showClass: {
                popup: 'animate__animated animate__fadeInDown'
            },
            hideClass: {
                popup: 'animate__animated animate__fadeOutUp'
            }
        }).then((result) => {
            dobInput.value = '';
            console.log("❌ DOB Reset:", {
                reason: "Birth year before 1980",
                selectedYear: birthDate.getFullYear()
            });
        });
        return false;
    }

    // Check if person is exactly 18 years old
    const eighteenYearsAgo = new Date();
    eighteenYearsAgo.setFullYear(eighteenYearsAgo.getFullYear() - 18);
    
    if (birthDate > eighteenYearsAgo) {
        Swal.fire({
            icon: 'warning',
            title: 'Age Verification',
            text: 'Member must be at least 18 years old.',
            confirmButtonColor: '#d01f2f',
            confirmButtonText: 'Choose Different Date',
            showClass: {
                popup: 'animate__animated animate__fadeInDown'
            },
            hideClass: {
                popup: 'animate__animated animate__fadeOutUp'
            }
        }).then((result) => {
            dobInput.value = '';
            console.log("❌ DOB Reset:", {
                reason: "Under 18 years",
                exactAge: `${exactAge.years} years, ${exactAge.months} months, ${exactAge.days} days`
            });
        });
        return false;
    }

    console.log("✅ DOB Validation Passed:", {
        birthDate: birthDate.toISOString().split('T')[0],
        exactAge: `${exactAge.years} years, ${exactAge.months} months, ${exactAge.days} days`
    });
    return true;
}

// Set max date to 18 years ago from today
const maxDate = new Date();
maxDate.setFullYear(maxDate.getFullYear() - 18);
dobInput.max = maxDate.toISOString().split('T')[0];

// Add event listener for date input
dobInput.addEventListener('change', function() {
    validateDOB(this.value);
});
</script>

<style>
  /* Target only the DOB input specifically */
  #member_date_of_birth {
    cursor: pointer;
  }
  
  #member_date_of_birth:invalid {
    border-color: #dc3545;
  }
  
  /* Animation classes remain the same */
  @keyframes fadeInDown {
    from {
      opacity: 0;
      transform: translate3d(0, -20px, 0);
    }
    to {
      opacity: 1;
      transform: translate3d(0, 0, 0);
    }
  }
  
  @keyframes fadeOutUp {
    from {
      opacity: 1;
      transform: translate3d(0, 0, 0);
    }
    to {
      opacity: 0;
      transform: translate3d(0, -20px, 0);
    }
  }
</style> 

<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkbox = document.getElementById('showEmergencyContact');
    const emergencySection = document.getElementById('emergencyContactSection');

    checkbox.addEventListener('change', function() {
        if (this.checked) {
            emergencySection.style.display = 'block';
            setTimeout(() => {
                emergencySection.style.opacity = '1';
            }, 50);
        } else {
            emergencySection.style.opacity = '0';
            setTimeout(() => {
                emergencySection.style.display = 'none';
            }, 300);
        }
    });
});
</script> 